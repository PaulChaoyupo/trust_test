
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‡ªè¦ºç¨‹åº¦æ¨¡çµ„ï½œä¼æ¥­å¾Œå°åˆ†æ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background: #f5f7fa; padding: 2rem; max-width: 960px; margin: auto; color: #333; }
    h1, h2 { color: #1d3557; }
    section { background: #fff; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 2rem; }
    .select { padding: 0.8rem; font-size: 1rem; width: 100%; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>ä¼æ¥­å¾Œå°ï½œé›™å±¤ç¯©é¸åˆ†æ</h1>

  <section>
    <h2>ğŸ“‹ é¸æ“‡å—æ¸¬æ—¥æœŸèˆ‡å§“å</h2>
    <label>é¸æ“‡æ—¥æœŸï¼š</label>
    <select id="dateSelector" class="select"><option value="">è«‹é¸æ“‡æ—¥æœŸ</option></select>
    <label>é¸æ“‡å—æ¸¬è€…ï¼š</label>
    <select id="userSelector" class="select" disabled><option value="">è«‹å…ˆé¸æ“‡æ—¥æœŸ</option></select>
  </section>

  <div id="analysisArea" style="display:none">
    <section><h2>ğŸ“Š é›·é”åœ–</h2><canvas id="radarChart" height="300"></canvas></section>
    <section><h2>ğŸ” é›·é”ç¸½çµèª</h2><p id="radarSummary">-</p></section>
    <section><h2>ğŸ§  æ¨¡æ“¬æ¨£è²Œ</h2><div id="personaBlock">-</div></section>
    <section><h2>ğŸŒŸ å„ªå‹¢æ•˜è¿°</h2><div id="advBlock">-</div></section>
    <section><h2>âš ï¸ é¢¨éšªæ•˜è¿°</h2><div id="riskBlock">-</div></section>
  </div>

  <script>
    const dimensionMap = {
      "åœ˜éšŠå±•ç¾": [0, 1, 32], "è‡ªæˆ‘èªçŸ¥": [2, 6, 8, 9, 10, 11, 26, 27, 28, 29, 30, 32, 34],
      "åŸ·è¡Œèƒ½åŠ›": [4, 5, 19, 20, 21], "å‰µæ„å±•ç¾": [12, 13, 14, 17, 18], "å·¥ä½œé¢¨æ ¼": [3, 7, 15, 16, 31, 33]
    };

    const summaries = {
      "å·¥ä½œé¢¨æ ¼": "ä½ æ“æœ‰æ˜ç¢ºçš„è¡Œå‹•é‚è¼¯èˆ‡å …æŒï¼Œæ“…é•·åœ¨ä¸ç¢ºå®šä¸­ä¿æŒç¯€å¥èˆ‡æ•ˆç‡ã€‚",
      "åœ˜éšŠå±•ç¾": "ä½ ç¿’æ…£è§€å¯Ÿç¾¤é«”å‹•æ…‹ä¸¦ä¸»å‹•èª¿å’Œåœ˜éšŠæ­¥èª¿ï¼Œæ˜¯ç©©å®šäº’å‹•èˆ‡å…±è­˜ç”¢å‡ºçš„å‚¬åŒ–åŠ‘ã€‚",
      "è‡ªæˆ‘èªçŸ¥": "ä½ å°è‡ªå·±çš„æ„Ÿå—èˆ‡è¨€è¡Œå…·å‚™é«˜åº¦è‡ªçœèƒ½åŠ›ï¼Œå–„æ–¼ä¿®æ­£ä¸¦èª¿æ•´å°æ‡‰ä»–äººæ–¹å¼ã€‚",
      "åŸ·è¡Œèƒ½åŠ›": "ä½ æ“…é•·æŠŠæƒ³æ³•ä»˜è«¸è¡Œå‹•ï¼Œèƒ½é‡å°ç›®æ¨™åˆ¶å®šæ­¥é©Ÿï¼Œä¸¦æŒçºŒè·Ÿé€²æˆæœã€‚",
      "å‰µæ„å±•ç¾": "ä½ èƒ½å¾å¤šè§’åº¦æ€è€ƒèˆ‡çµ„åˆè³‡è¨Šï¼Œé©åˆåœ¨è®Šå‹•ä¸­æå‡ºå…·çªç ´æ€§èˆ‡å‰µæ–°æ€§æ–¹æ¡ˆã€‚"
    };

    const strengths = {
      "å·¥ä½œé¢¨æ ¼+åŸ·è¡Œèƒ½åŠ›": "å…·å‚™ç¯€å¥æ„Ÿèˆ‡è²¬ä»»æ„è­˜ï¼Œé©åˆæ¨å‹•ç©©å®šä»»å‹™æˆ–é•·æœŸè¨ˆç•«ã€‚",
      "åœ˜éšŠå±•ç¾+è‡ªæˆ‘èªçŸ¥": "å…·å‚™äººéš›æ„ŸçŸ¥èˆ‡è‡ªæˆ‘ä¿®æ­£åŠ›ï¼Œé©åˆæ–‡åŒ–å°å…¥ã€æ•™ç·´åŸ¹è‚²è§’è‰²ã€‚",
      "å‰µæ„å±•ç¾+è‡ªæˆ‘èªçŸ¥": "èƒ½å‰µé€ æ¦‚å¿µä¸¦å¿«é€Ÿä¿®æ­£ï¼Œé©åˆè®Šå‹•ç’°å¢ƒæˆ–ç­–ç•¥è¨­è¨ˆå ´åŸŸã€‚",
      "å·¥ä½œé¢¨æ ¼+å‰µæ„å±•ç¾": "èƒ½å…·é«”åŒ–å‰µæ„ä¸¦æ¨å‹•åŸ·è¡Œï¼Œæ˜¯çµ„ç¹”å…§çš„å‰µæ–°æ•´åˆè€…ã€‚",
      "åŸ·è¡Œèƒ½åŠ›+å‰µæ„å±•ç¾": "å…·å‚™å‰µæ„æƒ³æ³•èˆ‡å¯¦è¸èƒ½åŠ›ï¼Œé©åˆç ”ç™¼ã€ç”¢å“åŸå‹ã€æ¸¬è©¦é¡ä»»å‹™ã€‚",
      "å·¥ä½œ+åŸ·è¡Œ+åœ˜éšŠ": "ä¸‰å¼·æ§‹é¢è€…ç‚ºä»»å‹™èˆ‡äººéš›æ¨é€²å…¼å…·ï¼Œæ˜¯å¯è¢«åŸ¹é¤Šçš„é ˜å°æ½›èƒ½äººæ‰ã€‚"
    };

    const risks = {
      "å·¥ä½œé¢¨æ ¼": "ç¯€å¥èˆ‡ä»»å‹™æŒæ¡è¼ƒå¼±ï¼Œå»ºè­°æ­é…æœ‰çµæ§‹ä¸»ç®¡èˆ‡é€±æœŸæé†’æ©Ÿåˆ¶ã€‚",
      "åœ˜éšŠå±•ç¾": "äº’å‹•åƒèˆ‡åº¦ä½ï¼Œå¯èƒ½åœ¨åœ˜é«”ä¸­é‚Šç·£åŒ–ï¼Œå»ºè­°æä¾›è§’è‰²è¨­å®šèˆ‡å¼•å°ã€‚",
      "è‡ªæˆ‘èªçŸ¥": "è¼ƒå°‘è‡ªæˆ‘åæ€ï¼Œå¯èƒ½é›£ä»¥æ¥å—å›é¥‹ï¼Œå»ºè­°æœ‰æ­·ç¨‹å›é¡§èˆ‡åŒå„•è§€å¯Ÿæ”¯æŒã€‚",
      "åŸ·è¡Œèƒ½åŠ›": "åŸ·è¡Œèµ·ä¼å¤§ï¼Œé©åˆçŸ­æœŸä»»å‹™æ‹†è§£èˆ‡éšæ®µå›å ±è¨­è¨ˆã€‚",
      "å‰µæ„å±•ç¾": "å‰µæ–°å½ˆæ€§ä½ï¼Œå»ºè­°åƒè€ƒæ¡ˆä¾‹å¼ç™¼æƒ³æˆ–æ¨¡æ¿è¼”åŠ©æ€ç¶­æ‹“å±•ã€‚"
    };

    function calculateAvg(scores) {
      const result = {};
      for (const [k, v] of Object.entries(dimensionMap)) {
        result[k] = parseFloat((v.reduce((sum, i) => sum + (scores[i] || 0), 0) / v.length).toFixed(2));
      }
      return result;
    }

    function renderRadar(data) {
      new Chart(document.getElementById("radarChart"), {
        type: 'radar',
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: 'äº”æ§‹é¢åˆ†æ•¸',
            data: Object.values(data),
            backgroundColor: 'rgba(33, 111, 163, 0.2)',
            borderColor: '#2170a3', pointBackgroundColor: '#2170a3'
          }]
        },
        options: {
          scales: { r: { min: 1, max: 3, ticks: { stepSize: 0.5 } } },
          plugins: { legend: { display: false } }
        }
      });
    }

    window.onload = () => {
      const dataset = JSON.parse(localStorage.getItem("trust_test_dataset") || "[]");
      const dateSelector = document.getElementById("dateSelector");
      const nameSelector = document.getElementById("userSelector");
      const dates = [...new Set(dataset.map(d => d.date))];
      dates.forEach(date => {
        const opt = document.createElement("option");
        opt.value = date; opt.text = date;
        dateSelector.appendChild(opt);
      });

      dateSelector.onchange = () => {
        nameSelector.innerHTML = "<option value=''>è«‹é¸æ“‡å§“å</option>";
        nameSelector.disabled = false;
        const date = dateSelector.value;
        const filtered = dataset.filter(d => d.date === date);
        filtered.forEach((d, i) => {
          const opt = document.createElement("option");
          opt.value = i;
          opt.text = d.name;
          nameSelector.appendChild(opt);
        });

        nameSelector.onchange = () => {
          const name = nameSelector.options[nameSelector.selectedIndex].text;
          const entry = filtered.find(d => d.name === name);
          if (!entry) return;

          const avg = calculateAvg(entry.scores);
          const sorted = Object.entries(avg).sort((a, b) => b[1] - a[1]);
          const top = sorted[0][0];
          const high = sorted.filter(([_, v]) => v >= 2.6).map(([k]) => k);
          const low = sorted.filter(([_, v]) => v < 2.1).map(([k]) => k);

          document.getElementById("analysisArea").style.display = "block";
          document.getElementById("radarSummary").innerText = summaries[top];
          document.getElementById("personaBlock").innerText = "ä¸»å°æ§‹é¢æ¨¡æ“¬æ¨£è²Œï¼š" + summaries[top];

          let key = high.slice(0, 3).join("+");
          if (!strengths[key]) key = high.slice(0, 2).join("+");
          document.getElementById("advBlock").innerText = strengths[key] || "æœªå®šç¾©é«˜åˆ†çµ„åˆ";

          document.getElementById("riskBlock").innerHTML = "<ul>" + low.map(k => "<li>" + risks[k] + "</li>").join("") + "</ul>";
          renderRadar(avg);
        };
      };
    };
  </script>
</body>
</html>
