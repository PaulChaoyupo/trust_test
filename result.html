
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>測驗結果</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>你的測驗結果分析</h2>
  <p id="basicInfo">姓名 / 日期</p>
  <canvas id="radarChart" height="320"></canvas>
  <div id="personaBlock">主導構面敘述載入中...</div>
  <div id="advBlock">優勢組合說明載入中...</div>
  <div id="riskBlock">低分構面風險建議載入中...</div>
  <div id="radarBlock">雷達圖整體解說載入中...</div>
  <script>
    const res = JSON.parse(localStorage.getItem("trust_test_result") || "{}");
    document.getElementById("basicInfo").innerText = `${res.name}｜${res.date}`;
    const dimensionMap = {"團隊展現":[0],"自我認知":[1],"執行能力":[2],"創意展現":[3],"工作風格":[4]};
    const dimensionKeyMap = {"團隊展現":"team","自我認知":"awareness","執行能力":"execution","創意展現":"creativity","工作風格":"workstyle"};
    const avg = {}; Object.keys(dimensionMap).forEach(k=>avg[k]=2.5);
    const avgKey = Object.fromEntries(Object.entries(avg).map(([k,v])=>[dimensionKeyMap[k],v]));
    const sorted = Object.entries(avgKey).sort((a,b)=>b[1]-a[1]);
    const top = sorted[0][0]; const high = sorted.filter(([_,v])=>v>=2.6).map(([k])=>k);
    const advKey = high.slice(0,3).sort().join("_")||high.slice(0,2).sort().join("_");
    function fetchInject(id,path){fetch(path).then(r=>r.ok?r.text():Promise.reject()).then(t=>document.getElementById(id).innerHTML=t).catch(()=>document.getElementById(id).innerHTML=`❌ 無法載入 ${path}`);}
    fetchInject("personaBlock",`persona_${top}_user.html`);
    fetchInject("advBlock",`strength_${advKey}_high_user.html`);
    fetchInject("radarBlock",`radar_${top}_user.html`);
    const riskDiv = document.getElementById("riskBlock");
    high.forEach(k=>{const d=document.createElement("div");riskDiv.appendChild(d);fetch(`risk_${k}_low_user.html`).then(r=>{if(!r.ok)throw new Error();return r.text();}).then(h=>d.innerHTML=h).catch(()=>d.innerHTML=`❌ 無法載入 risk_${k}_low_user.html`);});
  </script>
</body>
</html>
