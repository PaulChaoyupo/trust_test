
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>選擇分析對象｜偏誤風險分析</title>
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; padding: 2rem; background: #f0f2f5; max-width: 640px; margin: auto; }
    h2 { text-align: center; color: #1d3557; margin-bottom: 2rem; }
    label { font-weight: 500; margin-top: 1rem; display: block; }
    select, button {
      width: 100%; padding: 0.8rem; font-size: 1rem;
      margin-top: 0.5rem; border-radius: 8px; border: 1px solid #ccc;
    }
    button {
      background-color: #457b9d; color: white; border: none; cursor: pointer;
      margin-top: 2rem;
    }
    button:hover { background-color: #1d3557; }
  </style>
</head>
<body>
  <h2>查看員工偏誤分析結果</h2>
  <label for="department">選擇部門：</label>
  <select id="department"><option value="">請選擇</option></select>

  <label for="name">選擇員工姓名：</label>
  <select id="name"><option value="">請先選擇部門</option></select>

  <button onclick="goToResult()">查看分析結果</button>

<script>
  const headers = {
    "apikey": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InduYnZhbXJqb3lkZHVyaXdhZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxODQ4MjEsImV4cCI6MjA2MTc2MDgyMX0.AT_f5N-Kctcbkns47PyYurHxP9Z2ktRtbGgpyaMe4Oc",
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InduYnZhbXJqb3lkZHVyaXdhZXRkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxODQ4MjEsImV4cCI6MjA2MTc2MDgyMX0.AT_f5N-Kctcbkns47PyYurHxP9Z2ktRtbGgpyaMe4Oc"
  };

  const baseUrl = "https://wnbvamrjoydduriwaetd.supabase.co/rest/v1/results";

  const deptSelect = document.getElementById("department");
  const nameSelect = document.getElementById("name");

  fetch(baseUrl + "?select=department,name", { headers })
    .then(res => res.json())
    .then(data => {
      const uniqueDepts = [...new Set(data.map(d => d.department))].sort();
      uniqueDepts.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        deptSelect.appendChild(opt);
      });

      deptSelect.addEventListener("change", () => {
        nameSelect.innerHTML = '<option value="">請選擇</option>';
        const selectedDept = deptSelect.value;
        const names = [...new Set(data.filter(d => d.department === selectedDept).map(d => d.name))].sort();
        names.forEach(n => {
          const opt = document.createElement("option");
          opt.value = n;
          opt.textContent = n;
          nameSelect.appendChild(opt);
        });
      });
    });

  function goToResult() {
    const name = nameSelect.value;
    const department = deptSelect.value;
    if (!name || !department) return alert("請選擇完整資訊");
    window.location.href = `bias_result.html?name=${encodeURIComponent(name)}&department=${encodeURIComponent(department)}`;
  }
</script>
</body>
</html>
